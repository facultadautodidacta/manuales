<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>16. Scripts con Cron - Manual Linux Mint</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" rel="stylesheet">
  <style>
    :root { --primary-color:#87b84d; --secondary-color:#3c3c3c; --accent-color:#6a9e3d; --text-color:#2e3436; }
    body { font-family:'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; background:linear-gradient(135deg,#f8f9fa 0%,#e9ecef 100%); color:var(--text-color);} 
    .hero { background:linear-gradient(135deg,var(--secondary-color),#2c3e50); color:#fff; padding:3rem 0; border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,.1); margin-bottom:2rem; }
    .badge-pill { background:linear-gradient(135deg,var(--primary-color),var(--accent-color)); color:#fff; border-radius:20px; padding:.35rem .8rem; margin:.15rem; display:inline-block; font-size:.9rem; }
    .card-custom { border:none; border-radius:14px; background:#fff; box-shadow:0 8px 24px rgba(0,0,0,.08); overflow:hidden; }
    .card-header-custom { background:linear-gradient(135deg,var(--secondary-color),#2c3e50); color:#fff; padding:1rem 1.25rem; }
    .fade-in-up { animation:fadeInUp .6s ease-out; } @keyframes fadeInUp { from{opacity:0; transform:translateY(16px);} to{opacity:1; transform:translateY(0);} }
    .tip { background:#f7f9fc; border-left:5px solid var(--primary-color); padding:.75rem 1rem; border-radius:8px; }
    /* Terminal y salida esperada */
    .terminal-window { background:#2c3e50; color:#ecf0f1; border-radius:8px; padding:1rem; font-family:"Courier New", monospace; font-size:14px; border:1px solid #223546; box-shadow:0 5px 15px rgba(0,0,0,.2); }
    .terminal-prompt { color:#87b84d; font-weight:700; }
    .terminal-command { color:#ecf0f1; }
    .terminal-comment { color:#8fa6b3; font-style:italic; display:block; margin-top:.25rem; }
    .terminal-output { color:#bdc3c7; display:block; }
    .expected-output { background:#f7f9fc; border:1px solid rgba(135,184,77,.35); border-left:6px solid var(--primary-color); border-radius:8px; padding:.75rem 1rem; margin:.5rem 0 1rem; box-shadow:0 2px 10px rgba(0,0,0,.04); }
    .expected-title { font-weight:600; color:#2e7d32; margin-bottom:.35rem; }
    .expected-output pre { background:#fff; border:1px dashed rgba(44,62,80,.15); border-radius:6px; padding:.6rem .75rem; margin:0; font-family:"Courier New", monospace; font-size:.95rem; white-space:pre-wrap; word-break:break-word; }
  </style>
  <script>
    document.addEventListener('DOMContentLoaded',()=>{
      document.querySelectorAll('.fade-in-up').forEach((el,i)=>{ el.style.opacity='0'; setTimeout(()=>{ el.style.transition='opacity .5s'; el.style.opacity='1'; }, i*120); });
    });
  </script>
</head>
<body>
  <div class="container-fluid p-4">
    <div class="hero text-center fade-in-up">
      <div class="container">
        <i class="bi bi-clock-history" style="font-size:3.5rem"></i>
        <h1 class="display-6 fw-bold mt-2 mb-2">Scripts con Cron</h1>
        <p class="lead">Programa tareas automáticas de forma simple y segura</p>
        <div class="mt-2">
          <span class="badge-pill">crontab -e</span>
          <span class="badge-pill">@reboot</span>
          <span class="badge-pill">@daily</span>
          <span class="badge-pill">*/15</span>
          <span class="badge-pill">logs</span>
        </div>
      </div>
    </div>

    <!-- Antes de cron: ¿Qué es un script .sh? y cómo crear uno desde cero -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card card-custom fade-in-up">
          <div class="card-header-custom"><h2 class="h5 mb-0"><i class="bi bi-journal-code me-2"></i>Antes de cron: ¿Qué es un script .sh?</h2></div>
          <div class="card-body p-4">
            <p>Un <strong>script .sh</strong> es un archivo de texto con comandos que ejecuta el intérprete <strong>bash</strong>. Sirve para automatizar tareas repetitivas.</p>
            <ul>
              <li>La primera línea <strong>shebang</strong> indica qué intérprete usar: <code>#!/bin/bash</code>.</li>
              <li>Guárdalo, dale permisos de ejecución con <code>chmod +x</code> y ejecútalo: <code>./archivo.sh</code>.</li>
              <li>Usa <strong>rutas absolutas</strong> dentro del script; el entorno de cron es mínimo.</li>
            </ul>

            <h5 class="mt-2">Tu primer script: hola.sh</h5>
            <div class="terminal-window mb-2">
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">mkdir -p $HOME/scripts</span><br>
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">cat &gt; $HOME/scripts/hola.sh &lt;&lt;'EOF'
#!/bin/bash
# Script de ejemplo: hola.sh
# Ejecuta:  ./hola.sh [Nombre]

echo "Hola desde bash"
echo "Usuario: $(whoami)"
NOMBRE=${1:-Mundo}
echo "Hola, $NOMBRE"
EOF</span><br>
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">chmod +x $HOME/scripts/hola.sh</span><br>
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">$HOME/scripts/hola.sh</span><br>
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">$HOME/scripts/hola.sh Ana</span>
            </div>
            <div class="expected-output"><div class="expected-title">Salida esperada</div><pre>Hola desde bash
Usuario: tu_usuario
Hola, Mundo
Hola desde bash
Usuario: tu_usuario
Hola, Ana</pre></div>

            <div class="tip"><i class="bi bi-lightbulb me-2"></i>La línea <code>#!/bin/bash</code> (shebang) le dice al sistema que debe usar bash para ejecutar el archivo.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Qué es cron -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card card-custom fade-in-up">
          <div class="card-header-custom"><h2 class="h5 mb-0"><i class="bi bi-info-circle me-2"></i>¿Qué es Cron?</h2></div>
          <div class="card-body p-4">
            <p><strong>Cron</strong> ejecuta comandos o scripts en horarios específicos. Es ideal para copias de seguridad, limpieza, reportes y tareas rutinarias.</p>
            <div class="terminal-window mb-2">
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">sudo apt install -y cron</span>
              <span class="terminal-comment"># Cron suele venir instalado en Mint. Esto lo asegura.</span>
              <br>
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">sudo systemctl enable --now cron</span>
              <span class="terminal-comment"># Habilita e inicia el servicio</span>
            </div>
            <div class="tip"><i class="bi bi-lightbulb me-2"></i>Usa <code>crontab -e</code> para editar tus tareas y <code>crontab -l</code> para listarlas.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Sintaxis básica -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card card-custom fade-in-up">
          <div class="card-header-custom"><h2 class="h5 mb-0"><i class="bi bi-code me-2"></i>Sintaxis básica de crontab</h2></div>
          <div class="card-body p-4">
            <p>Formato: <code>minuto hora día-del-mes mes día-de-semana comando</code></p>
            <ul class="mb-2">
              <li><strong>minuto</strong> (0-59), <strong>hora</strong> (0-23), <strong>d-mes</strong> (1-31), <strong>mes</strong> (1-12), <strong>d-semana</strong> (0-7, 0 y 7=domingo).</li>
              <li><code>*</code> cualquier valor, <code>*/n</code> cada n, <code>1,15</code> lista, <code>1-5</code> rango.</li>
              <li>Atajos: <code>@reboot</code>, <code>@hourly</code>, <code>@daily</code>, <code>@weekly</code>, <code>@monthly</code>.</li>
            </ul>
            <div class="tip"><i class="bi bi-exclamation-triangle me-2"></i>Usa <strong>rutas absolutas</strong> y redirige salida a un <strong>log</strong>. El entorno de cron es mínimo.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Cuatro usos prácticos -->
    <div class="row mb-4">
      <div class="col-lg-6 mb-4">
        <div class="card card-custom h-100 fade-in-up">
          <div class="card-header-custom"><h3 class="h6 mb-0"><i class="bi bi-hdd me-2"></i>1) Reporte diario de espacio en disco</h3></div>
          <div class="card-body p-4">
            <p>Guarda un reporte en <code>$HOME/logs</code> cada día a las 07:00.</p>
            <div class="terminal-window mb-2">
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">mkdir -p $HOME/logs</span>
              <br>
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">crontab -e</span>
            </div>
            <div class="expected-output"><div class="expected-title">Pega esta línea</div><pre>0 7 * * * /bin/df -h &gt; $HOME/logs/disk-$(/bin/date +\%F).txt 2&gt;&1</pre></div>
          </div>
        </div>
      </div>

      <div class="col-lg-6 mb-4">
        <div class="card card-custom h-100 fade-in-up">
          <div class="card-header-custom"><h3 class="h6 mb-0"><i class="bi bi-recycle me-2"></i>2) Limpieza semanal de temporales</h3></div>
          <div class="card-body p-4">
            <p>El domingo a las 03:30 limpia cachés seguras en tu usuario.</p>
            <div class="expected-output"><div class="expected-title">Línea para crontab</div><pre>30 3 * * 0 /usr/bin/find $HOME/.cache -type f -mtime +15 -delete &gt;&gt; $HOME/logs/cleanup.log 2&gt;&1</pre></div>
            <div class="tip"><i class="bi bi-shield-check me-2"></i>Ajusta <code>-mtime</code> (días) según tu espacio.</div>
          </div>
        </div>
      </div>

      <div class="col-lg-6 mb-4">
        <div class="card card-custom h-100 fade-in-up">
          <div class="card-header-custom"><h3 class="h6 mb-0"><i class="bi bi-wifi me-2"></i>3) Chequeo de conectividad cada 15 minutos</h3></div>
          <div class="card-body p-4">
            <p>Registra un ping para detectar cortes de Internet.</p>
            <div class="expected-output"><div class="expected-title">Línea para crontab</div><pre>*/15 * * * * /bin/ping -c 1 8.8.8.8 &gt;&gt; $HOME/logs/ping.log 2&gt;&1</pre></div>
          </div>
        </div>
      </div>

      <div class="col-lg-6 mb-4">
        <div class="card card-custom h-100 fade-in-up">
          <div class="card-header-custom"><h3 class="h6 mb-0"><i class="bi bi-arrow-repeat me-2"></i>4) Respaldo simple con rsync (ver cap. 15)</h3></div>
          <div class="card-body p-4">
            <p>Copia cambios de <code>Documentos</code> a una carpeta de respaldo cada noche (02:00).</p>
            <div class="expected-output"><div class="expected-title">Línea para crontab</div><pre>0 2 * * * /usr/bin/rsync -avh --delete $HOME/Documentos/ /mnt/backup/Documentos/ &gt;&gt; $HOME/logs/rsync.log 2&gt;&1</pre></div>
            <div class="tip"><i class="bi bi-exclamation-circle me-2"></i>Prueba antes con <code>--dry-run</code> y asegúrate de que <code>/mnt/backup</code> esté montado.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Buenas prácticas -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card card-custom fade-in-up">
          <div class="card-header-custom"><h2 class="h6 mb-0"><i class="bi bi-check2-circle me-2"></i>Buenas prácticas</h2></div>
          <div class="card-body p-4">
            <ul class="mb-0">
              <li>Usa rutas completas: <code>/usr/bin/python3</code>, <code>/bin/df</code>, etc.</li>
              <li>Redirige salida: <code>&gt;&gt; $HOME/logs/tarea.log 2&gt;&1</code> para depurar.</li>
              <li>Scripts ejecutables (<code>chmod +x</code>) y con <code>#!/bin/bash</code> al inicio.</li>
              <li>Para entornos de Python/Node, activa el entorno dentro del script, no en crontab.</li>
              <li><code>crontab -l</code> lista, <code>crontab -e</code> edita, <code>crontab -r</code> borra (¡cuidado!).</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Práctica breve -->
    <div class="row mb-5">
      <div class="col-12">
        <div class="card card-custom fade-in-up">
          <div class="card-header-custom"><h2 class="h4 mb-0"><i class="bi bi-mortarboard me-2"></i>Práctica guiada (5 minutos)</h2></div>
          <div class="card-body p-4">
            <p class="lead">Crea un script y prográmalo con cron de forma segura.</p>

            <h5>1) Crea un script de prueba</h5>
            <div class="terminal-window mb-2">
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">mkdir -p $HOME/scripts $HOME/logs</span><br>
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">cat &gt; $HOME/scripts/hola.sh &lt;&lt;'EOF'
#!/bin/bash
/bin/date "+%F %T" | /usr/bin/tee -a "$HOME/logs/hola.log" >/dev/null
EOF</span><br>
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">chmod +x $HOME/scripts/hola.sh &amp;&amp; $HOME/scripts/hola.sh</span>
            </div>
            <div class="expected-output"><div class="expected-title">Salida esperada</div><pre>Se crea/actualiza $HOME/logs/hola.log con la fecha/hora actual.</pre></div>

            <h5 class="mt-3">2) Programa el script cada 2 minutos</h5>
            <div class="terminal-window mb-2">
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">(crontab -l 2&gt;/dev/null; echo "*/2 * * * * $HOME/scripts/hola.sh") | crontab -</span>
            </div>
            <div class="expected-output"><div class="expected-title">Salida esperada</div><pre>La tarea queda registrada. Verifícala con: crontab -l</pre></div>

            <h5 class="mt-3">3) Verifica y limpia</h5>
            <div class="terminal-window mb-2">
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">tail -n 5 $HOME/logs/hola.log</span><br>
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command"># Para quitarla: crontab -e y borra la línea, o usa 'crontab -l | grep -v hola.sh | crontab -'</span>
            </div>
            <div class="alert alert-success mt-2"><i class="bi bi-check2-circle me-2"></i>Listo: ya sabes crear, programar y depurar tareas en cron.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Crear un script .sh desde cero (paso a paso) -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card card-custom fade-in-up">
          <div class="card-header-custom"><h2 class="h5 mb-0"><i class="bi bi-filetype-sh me-2"></i>Crear un script .sh desde cero (paso a paso)</h2></div>
          <div class="card-body p-4">
            <p>Vamos a crear <code>$HOME/scripts/sistema.sh</code> que recoge información útil (sistema, disco, memoria, red) y la guarda en un log. Luego podrás programarlo con cron.</p>

            <h5>1) Carpeta y archivo con shebang</h5>
            <div class="terminal-window mb-2">
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">mkdir -p $HOME/scripts $HOME/logs</span><br>
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">cat &gt; $HOME/scripts/sistema.sh &lt;&lt;'EOF'
#!/bin/bash
set -euo pipefail
LOG="$HOME/logs/sistema.log"

header() {
  echo "==== $(date '+%F %T') :: $1 ====" | tee -a "$LOG" >/dev/null
}

check_cmd() { command -v "$1" &>/dev/null || echo "[Aviso] Falta comando: $1" | tee -a "$LOG" >/dev/null; }

info_sistema() {
  header "INFO DEL SISTEMA"
  echo "Usuario: $(whoami)" | tee -a "$LOG" >/dev/null
  echo "Kernel: $(uname -r)" | tee -a "$LOG" >/dev/null
  echo "Uptime: $(uptime -p)" | tee -a "$LOG" >/dev/null
}

disco() {
  header "DISCO (df -h)"
  df -h | head -n 10 | tee -a "$LOG" >/dev/null
}

memoria() {
  header "MEMORIA (free -h)"
  free -h | tee -a "$LOG" >/dev/null
}

red() {
  header "RED (ip -brief addr)"
  if command -v ip &>/dev/null; then
    ip -brief addr show | tee -a "$LOG" >/dev/null
  else
    ifconfig | tee -a "$LOG" >/dev/null || true
  fi
  header "PING (8.8.8.8)"
  ping -c 1 8.8.8.8 | tee -a "$LOG" >/dev/null || echo "Ping falló" | tee -a "$LOG" >/dev/null
}

main() {
  touch "$LOG"
  check_cmd df; check_cmd free; check_cmd ip; check_cmd ping
  case "${1:-todo}" in
    info)    info_sistema ;;
    disco)   disco ;;
    memoria) memoria ;;
    red)     red ;;
    todo)    info_sistema; disco; memoria; red ;;
    *) echo "Uso: $0 [info|disco|memoria|red|todo]" | tee -a "$LOG" >/dev/null ;;
  esac
}

main "$@"
EOF</span><br>
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">chmod +x $HOME/scripts/sistema.sh</span>
            </div>
            <div class="expected-output"><div class="expected-title">Salida esperada</div><pre>Se crea $HOME/scripts/sistema.sh y el archivo es ejecutable.</pre></div>

            <h5 class="mt-3">2) Ejecuta el script (todo e individual)</h5>
            <div class="terminal-window mb-2">
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">$HOME/scripts/sistema.sh</span><br>
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">$HOME/scripts/sistema.sh disco</span><br>
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">tail -n 20 $HOME/logs/sistema.log</span>
            </div>
            <div class="expected-output"><div class="expected-title">Salida esperada</div><pre>==== 2025-08-18 12:34:56 :: INFO DEL SISTEMA ====
Usuario: tu_usuario
Kernel: 6.x.x-mint
Uptime: up 1 hour, 2 minutes
==== 2025-08-18 12:34:56 :: DISCO (df -h) ====
Filesystem      Size  Used Avail Use% Mounted on
...</pre></div>

            <h5 class="mt-3">3) (Opcional) Añádelo a cron</h5>
            <div class="terminal-window mb-2">
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">(crontab -l 2&gt;/dev/null; echo "0 * * * * $HOME/scripts/sistema.sh &gt;&gt; $HOME/logs/sistema.log 2&gt;&1") | crontab -</span>
              <span class="terminal-comment"># Se ejecuta cada hora y agrega salida al log</span>
            </div>
            <div class="tip"><i class="bi bi-shield-check me-2"></i>Puedes pasar un módulo específico: <code>... sistema.sh disco</code> para registrar sólo el disco.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
