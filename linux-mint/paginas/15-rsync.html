<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>15. Copias y sincronización con rsync - Manual Linux Mint</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" rel="stylesheet">
  <style>
    :root { --primary-color:#87b84d; --secondary-color:#3c3c3c; --accent-color:#6a9e3d; --text-color:#2e3436; }
    body { font-family:'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; background:linear-gradient(135deg,#f8f9fa 0%,#e9ecef 100%); color:var(--text-color);} 
    .hero { background:linear-gradient(135deg,var(--secondary-color),#2c3e50); color:#fff; padding:3rem 0; border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,.1); margin-bottom:2rem; }
    .badge-pill { background:linear-gradient(135deg,var(--primary-color),var(--accent-color)); color:#fff; border-radius:20px; padding:.35rem .8rem; margin:.15rem; display:inline-block; font-size:.9rem; }
    .card-custom { border:none; border-radius:14px; background:#fff; box-shadow:0 8px 24px rgba(0,0,0,.08); overflow:hidden; }
    .card-header-custom { background:linear-gradient(135deg,var(--secondary-color),#2c3e50); color:#fff; padding:1rem 1.25rem; }
    .fade-in-up { animation:fadeInUp .6s ease-out; } @keyframes fadeInUp { from{opacity:0; transform:translateY(16px);} to{opacity:1; transform:translateY(0);} }
    .tip { background:#f7f9fc; border-left:5px solid var(--primary-color); padding:.75rem 1rem; border-radius:8px; }
    /* Terminal y salida esperada */
    .terminal-window { background:#2c3e50; color:#ecf0f1; border-radius:8px; padding:1rem; font-family:"Courier New", monospace; font-size:14px; border:1px solid #223546; box-shadow:0 5px 15px rgba(0,0,0,.2); }
    .terminal-prompt { color:#87b84d; font-weight:700; }
    .terminal-command { color:#ecf0f1; }
    .terminal-comment { color:#8fa6b3; font-style:italic; display:block; margin-top:.25rem; }
    .terminal-output { color:#bdc3c7; display:block; }
    .expected-output { background:#f7f9fc; border:1px solid rgba(135,184,77,.35); border-left:6px solid var(--primary-color); border-radius:8px; padding:.75rem 1rem; margin:.5rem 0 1rem; box-shadow:0 2px 10px rgba(0,0,0,.04); }
    .expected-title { font-weight:600; color:#2e7d32; margin-bottom:.35rem; }
    .expected-output pre { background:#fff; border:1px dashed rgba(44,62,80,.15); border-radius:6px; padding:.6rem .75rem; margin:0; font-family:"Courier New", monospace; font-size:.95rem; white-space:pre-wrap; word-break:break-word; }
  </style>
  <script>
    document.addEventListener('DOMContentLoaded',()=>{
      document.querySelectorAll('.fade-in-up').forEach((el,i)=>{ el.style.opacity='0'; setTimeout(()=>{ el.style.transition='opacity .5s'; el.style.opacity='1'; }, i*120); });
    });
  </script>
</head>
<body>
  <div class="container-fluid p-4">
    <div class="hero text-center fade-in-up">
      <div class="container">
        <i class="bi bi-arrow-repeat" style="font-size:3.5rem"></i>
        <h1 class="display-6 fw-bold mt-2 mb-2">Copias y sincronización con rsync</h1>
        <p class="lead">Rápido, seguro e incremental: ideal para respaldos y despliegues</p>
        <div class="mt-2">
          <span class="badge-pill">-a</span>
          <span class="badge-pill">--delete</span>
          <span class="badge-pill">-z</span>
          <span class="badge-pill">--exclude</span>
          <span class="badge-pill">--dry-run</span>
        </div>
      </div>
    </div>

    <!-- Qué es rsync -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card card-custom fade-in-up">
          <div class="card-header-custom"><h2 class="h5 mb-0"><i class="bi bi-info-circle me-2"></i>¿Qué es rsync y por qué usarlo?</h2></div>
          <div class="card-body p-4">
            <p><strong>rsync</strong> sincroniza archivos y directorios de forma eficiente: sólo transfiere diferencias, conserva permisos/fechas y funciona local o por SSH.</p>
            <ul class="mb-2">
              <li><strong>-a</strong>: modo archivo (recursivo, conserva permisos/propietarios/fechas).</li>
              <li><strong>-v</strong>: verbose, <strong>-h</strong>: tamaños legibles, <strong>-z</strong>: comprime al transferir.</li>
              <li><strong>--delete</strong>: hace espejo (borra en destino lo que ya no existe en origen).</li>
              <li><strong>--exclude</strong>: excluye rutas/patrones. <strong>--dry-run</strong>: simula sin cambiar nada.</li>
            </ul>
            <div class="tip"><i class="bi bi-shield-check me-2"></i>Prueba primero con <code>--dry-run</code> para ver qué haría sin tocar tus archivos.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- 1. Copia local incremental -->
    <div class="row mb-4">
      <div class="col-lg-6 mb-4">
        <div class="card card-custom h-100 fade-in-up">
          <div class="card-header-custom"><h3 class="h6 mb-0"><i class="bi bi-folder-symlink me-2"></i>1) Copia local incremental (backup rápido)</h3></div>
          <div class="card-body p-4">
            <p>Sincroniza una carpeta a otra ruta local. Sólo copia cambios.</p>
            <div class="terminal-window mb-2">
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">rsync -avh --progress ~/Documentos/proyecto/ ~/Backups/proyecto/</span>
              <span class="terminal-comment"># Nota la barra final "/": copia el contenido dentro de destino</span>
            </div>
            <div class="expected-output"><div class="expected-title">Salida esperada</div><pre>sending incremental file list
archivo1.txt
carpeta/archivo2.md
...
sent 12.34M  received 56.7K  bytes  8.90M/s
</pre></div>
          </div>
        </div>
      </div>

      <!-- 2. Espejo con borrados -->
      <div class="col-lg-6 mb-4">
        <div class="card card-custom h-100 fade-in-up">
          <div class="card-header-custom"><h3 class="h6 mb-0"><i class="bi bi-arrow-left-right me-2"></i>2) Espejo exacto con borrados (--delete)</h3></div>
          <div class="card-body p-4">
            <p>Haz que destino sea un <strong>espejo</strong> del origen (cuidado: borra en destino lo que no exista en origen).</p>
            <div class="terminal-window mb-2">
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">rsync -avh --delete ~/Fotos/ ~/DiscoExterno/Fotos/</span>
              <span class="terminal-comment"># Úsalo sólo si estás seguro de que el origen es la fuente de verdad</span>
            </div>
            <div class="expected-output"><div class="expected-title">Salida esperada</div><pre>sending incremental file list
deleting Fotos_viejas/2020/duplicado.jpg
nuevas/imagen1.jpg
...
</pre></div>
          </div>
        </div>
      </div>
    </div>

    <!-- 3. Subir a servidor por SSH -->
    <div class="row mb-4">
      <div class="col-lg-6 mb-4">
        <div class="card card-custom h-100 fade-in-up">
          <div class="card-header-custom"><h3 class="h6 mb-0"><i class="bi bi-cloud-upload me-2"></i>3) Subir a un servidor (vía SSH)</h3></div>
          <div class="card-body p-4">
            <p>Transfiere de tu PC a un servidor. Requiere acceso SSH.</p>
            <div class="terminal-window mb-2">
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">rsync -avz --progress -e "ssh -p 22" ~/web/ usuario@mi-servidor:/var/www/web/</span>
              <span class="terminal-comment"># Cambia puerto/IP/usuario según tu servidor</span>
            </div>
            <div class="expected-output"><div class="expected-title">Salida esperada</div><pre>sending incremental file list
index.html
assets/css/styles.css
...
</pre></div>
          </div>
        </div>
      </div>

      <!-- 4. Descargar del servidor (pull) con exclusiones -->
      <div class="col-lg-6 mb-4">
        <div class="card card-custom h-100 fade-in-up">
          <div class="card-header-custom"><h3 class="h6 mb-0"><i class="bi bi-cloud-download me-2"></i>4) Descargar (pull) con exclusiones</h3></div>
          <div class="card-body p-4">
            <p>Baja contenido desde un servidor, excluyendo carpetas temporales.</p>
            <div class="terminal-window mb-2">
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">rsync -avz --exclude "node_modules/" --exclude ".git/" usuario@mi-servidor:/home/usuario/app/ ~/app/</span>
              <span class="terminal-comment"># Evita descargar dependencias y repositorios</span>
            </div>
            <div class="expected-output"><div class="expected-title">Salida esperada</div><pre>sending incremental file list
./
app.js
package.json
</pre></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Consejos útiles -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card card-custom fade-in-up">
          <div class="card-header-custom"><h2 class="h6 mb-0"><i class="bi bi-lightbulb me-2"></i>Consejos rápidos</h2></div>
          <div class="card-body p-4">
            <ul class="mb-0">
              <li>Usa <code>--dry-run</code> para simular. Añade <code>--delete</code> sólo si necesitas espejo.</li>
              <li>La barra final <code>/</code> importa: <code>origen/</code> copia el <em>contenido</em>; <code>origen</code> copia el directorio entero.</li>
              <li>Para rutas con espacios, usa comillas: <code>"Mi Carpeta"</code>.</li>
              <li>Programa rsync con <em>cron</em> para respaldos automáticos (ver capítulo de cron).</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Práctica breve -->
    <div class="row mb-5">
      <div class="col-12">
        <div class="card card-custom fade-in-up">
          <div class="card-header-custom"><h2 class="h4 mb-0"><i class="bi bi-mortarboard me-2"></i>Práctica guiada (5 minutos)</h2></div>
          <div class="card-body p-4">
            <p class="lead">Simula un respaldo local seguro con prueba previa.</p>

            <h5>1) Prepara carpetas y haz un DRY RUN</h5>
            <div class="terminal-window mb-2">
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">mkdir -p ~/demo-rsync/origen ~/demo-rsync/destino</span><br>
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">echo "hola" > ~/demo-rsync/origen/a.txt && echo "mundo" > ~/demo-rsync/origen/b.txt</span><br>
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">rsync -avh --dry-run ~/demo-rsync/origen/ ~/demo-rsync/destino/</span>
            </div>
            <div class="expected-output"><div class="expected-title">Salida esperada</div><pre>sending incremental file list
a.txt
b.txt
</pre></div>

            <h5 class="mt-3">2) Ejecuta la copia real</h5>
            <div class="terminal-window mb-2">
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">rsync -avh ~/demo-rsync/origen/ ~/demo-rsync/destino/</span>
            </div>
            <div class="expected-output"><div class="expected-title">Salida esperada</div><pre>sent ... received ... bytes ...
~/demo-rsync/destino contiene a.txt y b.txt</pre></div>

            <h5 class="mt-3">3) Prueba el modo espejo (--delete)</h5>
            <div class="terminal-window mb-2">
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">rm ~/demo-rsync/origen/b.txt</span><br>
              <span class="terminal-prompt">usuario@mint:~$</span> <span class="terminal-command">rsync -avh --delete ~/demo-rsync/origen/ ~/demo-rsync/destino/</span>
            </div>
            <div class="expected-output"><div class="expected-title">Salida esperada</div><pre>deleting b.txt
</pre></div>

            <div class="alert alert-success mt-2"><i class="bi bi-check2-circle me-2"></i>Listo: ya sabes copiar, espejar y transferir con rsync de forma segura.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
